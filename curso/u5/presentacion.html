---
layout: presentacion
title: Introducción al uso de OpenStack (StackOps Portal) (4)
tema: sky
---

<section>
	    <h2>Introducción al uso de OpenStack (StackOps Portal) (4) APIS</h2>
	    <p>
	      <small><a href="http://albertomolina.wordpress.com">Alberto Molina
	      Coballes</a> / <a
	      href="http://twitter.com/alberto_molina">@alberto_molina</a> y <a
	      href="http://josedomingo.org">José Domingo Muñoz
	      Rodríguez</a> / <a
	      href="http://twitter.com/Pledin_JD">@Pledin_JD</a> </small>
	    </p>
	    <p><small>
		<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../img/cc_by_sa.png"
		width="100px" border="0"/></a></small></p>
	  <section>
  <section>
    <h2>Instancias con OpenStack CLI</h2>
    <ul>
      <li>Cada componente de OpenStack tiene su propio cliente de línea de
      comandos con toda las funcionalidades</li>
      <li>Existe un cliente "unificado" (nova) que permite utilizar las
      funcionalidades básicas de los componentes principales</li>
    </ul>
  </section>
  <section>
    <h2>Configuración del entorno</h2>
    <ul>
      <li>Obtenemos el fichero openrc de Horizon <small>(Acceso y seguridad->Acceso a la API->Descargar archivo RC de OpenStack)</small></li>
      <li>Instalamos en el equipo el cliente de línea de comandos de OpenStack
      (con este método instalamos la última versión):
  <pre><code>
# apt-get install python-pip
# pip install python-novaclient
  </code></pre></li>
      <li>Iniciamos la sesión del usuario:
  <pre><code>
$ source proy-usuario22.sh
  </code></pre></li>
      <li>Comprobamos que funciona correctamente:
  <pre><code>
$ nova flavor-list
        </code></pre></li>
    </ul>
  </section>

<section>
  <h2>Instancias (1)</h2>
  <pre><code>
#Listar de imágenes
$ nova image-list

# Listar sabores
$ nova flavor-list

# Listar las redes que tenemos definidas
$ nova net-list

# Listar grupos de seguridad
$ nova secgroup-list

# Listar claves ssh
$ nova keypair-list
  </code></pre>
</section>
<section>
  <h2>Instancias (2)</h2>
  <pre><code>
# Creamos una instancia
$ nova boot --flavor FLAVOR_ID --image IMAGE_ID
            --security-groups SEC_GROUP --key-name KEY_NAME \
      --nic net-id=NET_ID \
      INSTANCE_NAME

# Ejemplo
$ nova boot --flavor m1.tiny --image cirros-0.3.1-x86_64-uec \
            --security-groups default --key-name mis_claves 
            --nic net-id=d8d4d80e-923f-47fc-ac88-b9079328080b \
            instancia_prueba
  </code></pre>
</section>

<section>
  <h2>Instancias (3)</h2>
  <pre><code>
# Pausar instancia
$ nova pause INSTANCE_NAME 
$ nova unpause INSTANCE_NAME 

# Suspender/resumir
$ nova suspend INSTANCE_NAME
$ nova resume INSTANCE_NAME

# Reiniciar
$ nova reboot --hard SERVER

# Borrar
$ nova delete INSTANCE_NAME

# Acceder por consola
$ nova get-vnc-console INSTANCE_NAME novnc
  </code></pre>
</section>

<section>
  <h2>IPs Flotantes</h2>
  <pre><code>
# Listar el pool de ip flotantes
$ nova floating-ip-pool-list

# Listar las ip flotantes que asignadas al proyecto
$ nova floating-ip-list

# Asignar una IP flotante al proyecto
$ nova floating-ip-create

# Asociar una IP flotante a una instancia
$ nova floating-ip-associate instancia_prueba 172.24.4.227

# Desasociar una IP flotante de una instancia
$ nova floating-ip-disassociate instancia_prueba 172.24.4.227
  </code></pre>
</section>
<section>
  <h2>Grupos de seguridad</h2>
  <pre><code>
# Listar grupos de seguridad
$ nova secgroup-list

# Crear un grupo de seguridad
$ nova secgroup-create cortafuegos

# Listar reglas de un grupo de seguridad
$ nova secgroup-list-rules default

# Añadir una regla a un grupo de seguridad
$ nova secgroup-add-rule default tcp 22 22 0.0.0.0/0
  </code></pre>
</section>
<section>
  <h2>Claves SSH</h2>
  <pre><code>
# Crear un par de claves ssh
$ nova keypair-add mi_claves > mi_claves.pem
$ chmod 600 mi_clave.pem

# Listar las claves ssh
$ nova keypair-list
  </code></pre>
</section>
<section>
  <h2>Instantáneas</h2>
  <pre><code>
# Crear una instantánea de una instancia
$ nova image-create --poll instancia_prueba snapshot_prueba

# Listar instantáneas (e imágenes)
$ nova image-list

# Para crear una nueva instancia se puede usar esta instantánea como cualquier
# otra imagen
  </code></pre>
</section>
</section>